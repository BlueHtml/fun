!function(e){function t(e){this.el=e,this.drums=[].slice.call(this.el.querySelectorAll(".timpani__drum")),this.midiCode=47,this._initEvents()}t.prototype._initEvents=function(){var e=this,t=mobilecheck(),n={down:t?"touchstart":"mousedown",up:t?"touchend":"mouseup"},i=function(t,n){e._play(t,"on"),clearTimeout(e.sequencePlaying),e.sequencePlaying=setTimeout(function(){i(t,n)},180)};this.drums.forEach(function(o){o.addEventListener(n.down,function(n){var s=e._getNote(o);e.mdown=!0,t||(e.mouseLeaveFn=function(t){clearTimeout(e.sequencePlaying),e._play(s,"off"),e._changeKeyStatus(s),this.removeEventListener("mouseleave",e.mouseLeaveFn)},o.addEventListener("mouseleave",e.mouseLeaveFn)),i(s,o),e._changeKeyStatus(s)}),o.addEventListener(n.up,function(n){if(!e.mdown&&!t)return!1;e.mdown=!1,clearTimeout(e.sequencePlaying);var i=e._getNote(o);t||this.removeEventListener("mouseleave",e.mouseLeaveFn),e._play(i,"off"),e._changeKeyStatus(i)}),t||o.addEventListener("mouseenter",function(t){if(!e.mdown)return!1;var n=e._getNote(o);e.mouseLeaveFn=function(t){e._play(n,"off"),clearTimeout(e.sequencePlaying),e._changeKeyStatus(n),this.removeEventListener("mouseleave",e.mouseLeaveFn)},o.addEventListener("mouseleave",e.mouseLeaveFn),i(n,o),e._changeKeyStatus(n)})}),t||(this.el.addEventListener("mousedown",function(t){e.mdown=!0}),this.el.addEventListener("mouseup",function(t){e.mdown=!1,clearTimeout(e.sequencePlaying)}),this.el.addEventListener("mouseleave",function(t){e.mdown=!1,clearTimeout(e.sequencePlaying)}))},t.prototype._getNote=function(e){return e.getAttribute("note:id")},t.prototype._play=function(e,t){e=parseInt(e)+21;MIDI.programChange(0,this.midiCode),"on"===t?MIDI.noteOn(0,e,127,0):MIDI.noteOff(0,e,4)},t.prototype._getDrumByNote=function(e){for(var t=this.drums[0],n=0,i=this.drums.length;n<=i-1;++n)if(this.drums[n].getAttribute("note:id")==e){t=this.drums[n];break}return t},t.prototype._changeKeyStatus=function(e){var t=this._getDrumByNote(e);t.classList.contains("timpani__drum--active")?t.classList.remove("timpani__drum--active"):t.classList.add("timpani__drum--active")},e.Timpani=t}(window);