!function(n){"use strict";window.AudioContext&&function(){var e,t=!1,o=n.WebAudio={api:"webaudio"},i={},a={},r=127,u={};o.audioBuffers=u,o.send=function(n,e){},o.setController=function(n,e,t,o){},o.setVolume=function(n,e,t){t?setTimeout(function(){r=e},1e3*t):r=e},o.programChange=function(e,t,o){n.channels[e].instrument=t},o.pitchBend=function(e,t,o){n.channels[e].pitchBend=t},o.noteOn=function(o,f,c,d){d=d||0;var s=n.channels[o].instrument,l=u[s+""+f];if(l){if(d<e.currentTime&&(d+=e.currentTime),t)var v=e.createMediaElementSource(l);else(v=e.createBufferSource()).buffer=l;if(a){var p=v;for(var m in a)p.connect(a[m].input),p=a[m]}var T=c/127*(r/127)*2-1;if(v.connect(e.destination),v.playbackRate.value=1,v.gainNode=e.createGain(),v.gainNode.connect(e.destination),v.gainNode.gain.value=Math.min(1,Math.max(-1,T)),v.connect(v.gainNode),t){if(d)return setTimeout(function(){l.currentTime=0,l.play()},1e3*d);l.currentTime=0,l.play()}else v.start(d||0);return i[o+""+f]=v,v}},o.noteOff=function(o,a,r){r=r||0;var f=n.channels[o].instrument,c=u[f+""+a];if(c){r<e.currentTime&&(r+=e.currentTime);var d=i[o+""+a];if(d){if(d.gainNode){var s=d.gainNode.gain;s.linearRampToValueAtTime(s.value,r),s.linearRampToValueAtTime(-1,r+.3)}return t?r?setTimeout(function(){c.pause()},1e3*r):c.pause():d.noteOff?d.noteOff(r+.5):d.stop(r+.5),delete i[o+""+a],d}}},o.chordOn=function(n,e,t,i){for(var a,r={},u=0,f=e.length;u<f;u++)r[a=e[u]]=o.noteOn(n,a,t,i);return r},o.chordOff=function(n,e,t){for(var i,a={},r=0,u=e.length;r<u;r++)a[i=e[r]]=o.noteOff(n,i,t);return a},o.stopAllNotes=function(){for(var n in i){var t=0;t<e.currentTime&&(t+=e.currentTime);var o=i[n];o.gain.linearRampToValueAtTime(1,t),o.gain.linearRampToValueAtTime(0,t+.3),o.noteOff?o.noteOff(t+.3):o.stop(t+.3),delete i[n]}},o.setEffects=function(n){if(e.tunajs)for(var t=0;t<n.length;t++){var o=n[t],i=new e.tunajs[o.type](o);i.connect(e.destination),a[o.type]=i}},o.connect=function(t){n.setDefaultPlugin(o),o.setContext(e||new(window.AudioContext||window.webkitAudioContext),t.onsuccess)},o.getContext=function(){return e},o.setContext=function(o,i,a,r){e=o,"undefined"==typeof Tuna||e.tunajs||(e.tunajs=new Tuna(e));var f=[],c=n.keyToNote;for(var d in c)f.push(d);var s=function(n){for(var e in v)if(v[e])return;i&&(i(),i=null)},l=function(o,i,a,r){var f=o[r];f&&(v[i]++,function(n,o,i){if(t){var a=new Audio;a.src=n,a.controls=!1,a.autoplay=!1,a.preload=!1,a.addEventListener("canplay",function(){o&&o(a)}),a.addEventListener("error",function(n){i&&i(n)}),document.body.appendChild(a)}else if(0===n.indexOf("data:audio")){var r=n.split(",")[1],u=Base64Binary.decodeArrayBuffer(r);e.decodeAudioData(u,o,i)}else{var f=new XMLHttpRequest;f.open("GET",n,!0),f.responseType="arraybuffer",f.onload=function(){e.decodeAudioData(f.response,o,i)},f.send()}}(f,function(e){e.id=r;var t=n.keyToNote[r];if(u[i+""+t]=e,0==--v[i]){o.isLoaded=!0,s()}},function(n){}))},v={};for(var p in n.Soundfont){var m=n.Soundfont[p];if(!m.isLoaded){var T=n.GM.byName[p].number;v[T]=0;for(var g=0;g<f.length;g++){l(m,T,0,d=f[g])}}}setTimeout(s,1)}}()}(MIDI);