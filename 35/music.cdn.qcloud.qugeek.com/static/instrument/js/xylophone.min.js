!function(e){function t(e){this.el=e,this.keyboard=this.el.querySelector("svg.xylophone__inner"),this.naturalKeys=[].slice.call(this.keyboard.querySelectorAll(".xylophone__keys--natural > rect")),this.flatKeys=[].slice.call(this.keyboard.querySelectorAll(".xylophone__keys--flat > rect")),this.allkeys=this.naturalKeys.concat(this.flatKeys),this.midiCode=13,this._initEvents()}t.prototype._initEvents=function(){var e=this,t=mobilecheck(),n={down:t?"touchstart":"mousedown",up:t?"touchend":"mouseup"};this.allkeys.forEach(function(o){o.addEventListener(n.down,function(n){var s=n.target.getAttribute("note:id");e.mdown=!0,t||(e.mouseLeaveFn=function(t){e._play(s,"off"),e._changeKeyStatus(s),this.removeEventListener("mouseleave",e.mouseLeaveFn)},o.addEventListener("mouseleave",e.mouseLeaveFn)),e._play(s,"on",o),e._changeKeyStatus(s)}),o.addEventListener(n.up,function(n){if(!e.mdown&&!t)return!1;e.mdown=!1;var o=n.target.getAttribute("note:id");t||this.removeEventListener("mouseleave",e.mouseLeaveFn),e._play(o,"off"),e._changeKeyStatus(o)}),t||o.addEventListener("mouseenter",function(t){if(!e.mdown)return!1;var n=t.target.getAttribute("note:id");e.mouseLeaveFn=function(t){e._play(n,"off"),e._changeKeyStatus(n),this.removeEventListener("mouseleave",e.mouseLeaveFn)},o.addEventListener("mouseleave",e.mouseLeaveFn),e._play(n,"on",o),e._changeKeyStatus(n)})}),t||(this.el.addEventListener("mousedown",function(t){e.mdown=!0}),this.el.addEventListener("mouseup",function(t){e.mdown=!1}),this.el.addEventListener("mouseleave",function(t){e.mdown=!1}))},t.prototype._play=function(e,t,n){e=parseInt(e)+21;MIDI.programChange(0,this.midiCode),"on"===t?(MIDI.noteOn(0,e,127,0),anime({targets:n,duration:1e3,easing:"easeOutElastic",elasticity:800,translateX:[1,0]})):MIDI.noteOff(0,e,.5)},t.prototype._getKeyByNote=function(e){for(var t=this.allkeys[0],n=0,o=this.allkeys.length;n<=o-1;++n)if(this.allkeys[n].getAttribute("note:id")==e){t=this.allkeys[n];break}return t},t.prototype._changeKeyStatus=function(e){var t=this._getKeyByNote(e);t.classList.contains("xylophone__key--active")?t.classList.remove("xylophone__key--active"):t.classList.add("xylophone__key--active")},e.Xylophone=t}(window);